<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Cards Against Theâ€¯LCU</title>
<script src="/socket.io/socket.io.js"></script>
<style>
body{margin:0;font-family:'ArialÂ Black',sans-serif;background:#111;color:#fff;overflow:hidden;}
.screen{display:none;height:100vh;align-items:center;justify-content:center;flex-direction:column;}
#home{display:flex;}
button{padding:12px;font-weight:bold;border:none;border-radius:6px;cursor:pointer;margin:5px;}
#footer{position:absolute;bottom:10px;text-align:center;width:100%;color:orange;}
#chat-box{background:url('cardsback.png');background-size:cover;overflow-y:auto;height:180px;padding:8px;}
#admin-panel{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#222;border:3px solid cyan;padding:15px;z-index:10;border-radius:8px;}
</style>
</head>
<body>
<!-- HOME -->
<div id="home" class="screen">
  <h1 style="color:cyan;text-align:center;">LolcowÂ Fireâ€¯Presents<br>Cardsâ€¯Againstâ€¯Theâ€¯LCU</h1>
  <input id="name" placeholder="Username" style="padding:10px;text-align:center;">
  <button onclick="join()">Joinâ€¯Lobby</button>
  <div id="footer">Createdâ€¯andâ€¯Codedâ€¯byâ€¯Rykeen</div>
</div>

<!-- LOBBY -->
<div id="lobby" class="screen">
  <h2>Lobbyâ€¯â€“â€¯Waitingâ€¯forâ€¯Players</h2>
  <div id="playerList"></div>
  <button id="readyBtn" onclick="ready()">âœ…â€¯Ready</button>
</div>

<!-- GAME -->
<div id="game" class="screen" style="flex-direction:column;">
  <div style="background:#000;padding:8px;">ðŸ‘‘â€¯CZAR:â€¯<span id="czarName"></span></div>
  <div id="blackCard"></div>
  <div id="table"></div>
  <div id="hand"></div>
  <div style="position:fixed;top:10px;right:10px;">
    <button onclick="toggleChat()">ðŸ’¬</button>
    <button onclick="openAdmin()">ðŸ› </button>
  </div>
  <div id="chat" style="position:fixed;right:0;bottom:0;width:260px;background:#1a1a1a;">
    <div id="chat-box"></div>
    <input id="msg" placeholder="Message" style="width:70%;"><button onclick="sendMsg()">Send</button>
  </div>
  <audio id="music" controls style="position:fixed;bottom:5px;left:5px;width:200px;"></audio>
</div>

<!-- ADMIN DASH -->
<div id="admin-panel">
  <h3 style="color:cyan;">Adminâ€¯Dashboard</h3>
  <button onclick="admin('reset')" style="background:orange;">Resetâ€¯Game</button>
  <input id="yt" placeholder="YouTubeâ€¯URL">
  <button onclick="startMusic()">Playâ€¯Music</button>
  <div><button onclick="closeAdmin()">Close</button></div>
</div>

<script>
const socket=io();
let myHand=[],isCzar=false;
function show(s){document.querySelectorAll('.screen').forEach(x=>x.style.display='none');document.getElementById(s).style.display='flex';}
function join(){const n=document.getElementById('name').value.trim();if(!n)return;socket.emit('join',n);show('lobby');}
function ready(){socket.emit('ready-up');document.getElementById('readyBtn').disabled=true;}

socket.on('state',d=>{
 if(!d.started){show('lobby');
  document.getElementById('playerList').innerHTML=d.players.map(p=>`${p.username}${p.ready?'â€¯âœ…':''}`).join('<br>');
  return;}
 show('game');
 document.getElementById('czarName').textContent=d.czarName;
 const me=d.players.find(p=>p.id===socket.id);if(!me)return;
 isCzar=me.isCzar;myHand=me.hand;
 document.getElementById('blackCard').innerHTML=`<div style="background:#000;color:white;padding:15px;margin:10px;">${d.blackCard}</div>`;
 if(!isCzar&&!me.hasSubmitted){document.getElementById('hand').innerHTML=myHand.map(c=>`<button onclick="play('${c}')">${c==='__BLANK__'?'(Blank)â€¯Writeâ€¯One':c}</button>`).join('');}
 else document.getElementById('hand').innerHTML='';
 const allDone=d.submissions.length>=d.players.filter(p=>!p.isCzar).length;
 document.getElementById('table').innerHTML=d.submissions.map(s=>`<button ${isCzar&&allDone?`onclick="socket.emit('pick','${s.playerId}')"`:''}>${isCzar&&allDone?s.card:'???'}</button>`).join('');
});

function play(card){
 if(card==='__BLANK__'){const t=prompt('Typeâ€¯yourâ€¯customâ€¯cardâ€¯text');socket.emit('submit',card,t);}
 else socket.emit('submit',card);
}
function sendMsg(){const i=document.getElementById('msg');if(i.value.trim()){socket.emit('chat',i.value);i.value='';}}
socket.on('chat',d=>{const c=document.getElementById('chat-box');c.innerHTML+=`<div><b style="color:cyan">${d.user}:</b>â€¯${d.text}</div>`;c.scrollTop=c.scrollHeight;});
socket.on('announce',u=>alert(`${u}â€¯wonâ€¯thisâ€¯round!`));
socket.on('final-win',u=>alert(`${u}â€¯wonâ€¯theâ€¯game!â€¯Restarting...`));

function toggleChat(){const ch=document.getElementById('chat');ch.style.display=ch.style.display==='none'?'block':'none';}

// admin + music
let adminPw="";
function openAdmin(){
 if(!adminPw){adminPw=prompt("Adminâ€¯password?");socket.emit('admin',{type:'login',pw:adminPw});}
 document.getElementById('admin-panel').style.display='block';
}
function closeAdmin(){document.getElementById('admin-panel').style.display='none';}
function admin(t){socket.emit('admin',{type:t,pw:adminPw});}
function startMusic(){
 const url=document.getElementById('yt').value.trim();
 if(url)socket.emit('music',{url});
}
socket.on('music-play',d=>{
 const id=getVidId(d.url);if(!id)return;
 const audio=document.getElementById('music');
 audio.src=`https://www.youtube.com/embed/${id}?autoplay=1`;
 audio.play();
});
function getVidId(u){const m=u.match(/v=([\w-]+)/);return m?m[1]:null;}
</script>
</body>
</html>
